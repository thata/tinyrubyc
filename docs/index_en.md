---

marp: true
paginate: true
theme: gaia
class:
  - invert

style: |
  .en { padding-top: 10px; font-size: 0.8em; }
---

<!-- _class: lead invert -->

# ğŸ‘·ğŸ—ï¸ Building a "Ruby-like Language" Compiler in Ruby

## Rubyã§ã¤ãã‚‹Rubyã¿ãŸã„ãªè¨€èªã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©

Fukuoka RubyistKaigi 04
2024.09.07
@htkymtks

<!--
ä»Šæ—¥ã¯

Rubyã¿ãŸã„ãªè¨€èªã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’
Rubyã§ä½œã£ãŸãŠè©±ã¨ã€

ãã®ä¸­ã§å¾—ãŸã€ŒçµŒé¨“ã€ã‚„ã€Œã‚³ãƒ„ã€ã«ã¤ã„ã¦ãŠè©±ã—ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
-->

---

## ğŸ¦ About me

- ã¯ãŸã‘ã‚„ã¾ãŸã‹ã—
  Takashi Hatakeyama
- ESM, Inc.
  ![w:300](esm.png)
- Twitter(X)ï¼š @htkymtks
  ![w:600](twitter.png)

<!--
ã¾ãšè‡ªå·±ç´¹ä»‹ã§ã™ã€‚

ã¯ãŸã‘ã‚„ã¾ãŸã‹ã—ã¨ç”³ã—ã¾ã™ã€‚

æ ªå¼ä¼šç¤¾æ°¸å’Œã‚·ã‚¹ãƒ†ãƒ ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã¨ã„ã†ä¼šç¤¾ã§ã€Rubyãƒ—ãƒ­ã‚°ãƒ©ãƒã¨ã—ã¦åƒã„ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€ãƒ€ã‚¸ãƒ£ãƒ¬ãŒå¥½ããªã®ã§ã€æ€ã„ã¤ã„ãŸãƒ€ã‚¸ãƒ£ãƒ¬ã‚’Twitterã¸æ”¾æµã—ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚

ã“ã¡ã‚‰ã¯ã€Œæœ€è¿‘ã®ãŠæ°—ã«å…¥ã‚Šãƒ„ã‚¤ãƒ¼ãƒˆã€ã«ãªã‚Šã¾ã™ã€‚
-->

---

# ğŸ Hobbies

- ä½ãƒ¬ã‚¤ãƒ¤ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°<br><div class="en">Low-level Programming</div>
  - è‡ªä½œCPU
    <div class="en">Building a CPU</div>
  - è‡ªä½œRISC-Vã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿
    <div class="en">Building a RISC-V Simulator</div>
  - MinCamlã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ç§»æ¤
    <div class="en">Porting MinCaml Compiler</div>

![bg right:40% vertical](fpga.png) ![bg right w:550](tron.png)

<!--
ã¾ãŸã€è¶£å‘³ã§ä½ãƒ¬ã‚¤ãƒ¤ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã—ã¦ã„ã¾ã™ã€‚

CPUã‚’è‡ªä½œã—ãŸã‚Šã€
RISC-Vã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½œã£ãŸã‚Šã€
MinCamlã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ç§»æ¤ã—ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚
-->

---

# ğŸª MinCaml â†’ ğŸ’TinyRuby

- è¶£å‘³ã®MinCamlã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ç§»æ¤ã‚’è¡Œãªã£ã¦ã„ã‚‹ã†ã¡ã«ã€1ã‹ã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½œã‚ŠãŸããªã‚‹
  <div class="en">After porting MinCaml, I started wanting to build a compiler from scratch.</div>
- ãã“ã§ TinyRuby ã§ã™ã‚ˆ!!!

<!--
è¶£å‘³ã® MinCaml ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ç§»æ¤ã‚’ã—ã¦ã„ã‚‹ã†ã¡ã«ã€1ã‹ã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½œã‚ŠãŸããªã£ã¦ãã¾ã—ã¦ã€ãã“ã§ ä»Šæ—¥ãŠè©±ã—ã™ã‚‹ TinyRuby ã®é–‹ç™ºã‚’å§‹ã‚ã¾ã—ãŸã€‚
--->

---

# ğŸ™‚ Today's Topics

- Introduction to TinyRuby
- Tips for Building a Compiler
- First Steps in Building a Compiler

<!--
ä»Šæ—¥ãŠè©±ã—ã™ã‚‹ã“ã¨ã¯ã€

TinyRubyã®ç´¹ä»‹ã¨ã€

TinyRubyã®ä½œæˆã‚’é€šã˜ã¦å¾—ãŸã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä½œæˆã®ä¾¿åˆ©æƒ…å ±ã€Tipsã€ã«ã¤ã„ã¦ã€

ãã—ã¦ã€ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®åˆã‚ã®ä¸€æ­©ã€ã¨ã„ã†ã“ã¨ã§ã€å®Ÿéš›ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½œæˆã™ã‚‹æµã‚Œã‚’ãŠè¦‹ã›ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
-->

---

<style scoped> section { font-size: 2.0em; } </style>

# ğŸ‡ Introduction to TinyRuby

ã“ã‚“ãªæ„Ÿã˜ã®Rubyã¿ãŸã„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª

```ruby
#
# sample.rb
#

def fib(n)
  if n < 2
    n
  else
    fib(n-1) + fib(n-2)
  end
end

# 10ç•ªç›®ã®ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°ã‚’è¨ˆç®—
p fib(10)
```

<!--
ã§ã¯ TinyRuby ã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚TinyRubyã¯ã€ã“ã‚“ãªæ„Ÿã˜ã®Rubyã¿ãŸã„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã«ãªã‚Šã¾ã™ã€‚
-->

---

## ğŸ‡ğŸ‡ Build and run TinyRuby

ã“ã‚“ãªæ„Ÿã˜ã«ãƒ“ãƒ«ãƒ‰ã™ã‚‹

```sh
# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’å‡ºåŠ›
$ ruby tinyrubyc.rb sample.rb > sample.s

# ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ã‚¢ã‚»ãƒ³ãƒ–ãƒ«ã—ã¦å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
$ gcc sample.s libtinyruby.c

# å®Ÿè¡Œ
$ ./a.out
55
```

<!--
ã•ãã»ã©æ›¸ã„ãŸã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ“ãƒ«ãƒ‰æ‰‹é †ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

ã¾ãšã€TinyRubyã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ sample.rb ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœã®ã‚¢ã‚»ãƒ³ãƒ–ãƒªãŒæ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ sample.s ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚

æ¬¡ã«ã€å…ˆã»ã©ç”Ÿæˆã—ãŸã‚¢ã‚»ãƒ³ãƒ–ãƒªãƒ•ã‚¡ã‚¤ãƒ« sample.s ã‚’ã€gcc ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ã‚»ãƒ³ãƒ–ãƒ«ã¨ãƒªãƒ³ã‚¯ã‚’è¡Œã„ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ« a.out ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ« a.out ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡ŒçµæœãŒç”»é¢ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
-->

---

<!-- <style scoped> section { font-size: 1.9em; } </style> -->

# ğŸ¤– TinyRuby's parser

- TinyRuby uses parser of MinRuby
- MinRuby
  - æ›¸ç±ã€ŒRubyã§ã¤ãã‚‹Rubyã€ã«ç™»å ´ã™ã‚‹Rubyã®ã‚µãƒ–ã‚»ãƒƒãƒˆ
    <div class="en">A subset of Ruby that appears in the book "Learning Ruby by Making Ruby"</div>

![bg w:350 right:30% auto](ruby-de-ruby.png)

<!--
æ¬¡ã¯TinyRubyã®æ§‹æ–‡è§£æå™¨ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã«ã¤ã„ã¦ã§ã™ã€‚

TinyRubyã®ãƒ‘ãƒ¼ã‚µãƒ¼ã¯MinRubyã®ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ãã®ã¾ã¾åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

MinRubyã¨ã„ã†ã®ã¯ã€ã€ŒRubyã§ã¤ãã‚‹Rubyã€ã¨ã„ã†æ›¸ç±ã«ç™»å ´ã™ã‚‹ã€Rubyã®ã‚µãƒ–ã‚»ãƒƒãƒˆè¨€èªã§ã™ã€‚ã“ã¡ã‚‰ã®æ›¸å½±ãŒã€ŒRubyã§ã¤ãã‚‹Rubyã€ã«ãªã‚Šã¾ã™ã€‚
-->

---
## ğŸ¦ TinyRubyã¨MinRubyã®å·®ç•°

- Difference from MinRuby
  - Only support integer type
  - No support for Array and Hash
  - Up to 6 arguments for functions
- TinyRuby is a subset of MinRuby

<!--
TinyRubyã¯MinRubyã®ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ä½¿ã£ã¦ã¯ã„ã¾ã™ãŒã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®å®Ÿè£…ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã€MinRubyã‹ã‚‰ã„ãã¤ã‹ã®æ©Ÿèƒ½ãŒè½ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€
ã€Œãƒ‡ãƒ¼ã‚¿å‹ã¯æ•´æ•°å‹ã®ã¿ã€ã ã£ãŸã‚Šã€
ã€ŒArrayã¨Hashã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ã€ã ã£ãŸã‚Šã€
ã€Œé–¢æ•°ã®å¼•æ•°ã¯6ã¤ã¾ã§ã€ãªã©ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€TinyRubyã¯MinRubyã®ã‚µãƒ–ã‚»ãƒƒãƒˆè¨€èªã¨è¨€ãˆã¾ã™ã€‚
-->

---

## ğŸ§ Target environment of TinyRuby compiler

- CPU
  - x86-64
- OS
  - Linux
- Development environment
  - Macã‚„Windowsã®äººã¯Dockerä¸Šã®Linuxç’°å¢ƒãªã©ã§é–‹ç™ºã—ã¦ã­

<!--
TinyRubyã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç’°å¢ƒã¯ã€CPUãŒ x86-64 ã§ã€OSãŒ Linux ã¨ãªã‚Šã¾ã™ã€‚

macOS ã‚„ Windows ã‚’ãŠä½¿ã„ã®æ–¹ã¯ã€Docker ä¸Šã® Linux ç’°å¢ƒãªã©ã§é–‹ç™ºã§ãã¾ã™ã€‚
ç§ã‚‚ M1 Mac ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€Docker ä¸Šã§é–‹ç™ºã‚’è¡Œã„ã¾ã—ãŸã€‚
-->

---

# ğŸ¦Š Tips for Building a Compiler

1) Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’æ´»ç”¨
   <div class="en">Utilize the assembly code output by the C compiler</div>
2) ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ABIã‚’çŸ¥ã‚‹
    <div class="en">Understand registers and the ABI</div>
3) å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹
    <div class="en">Progress in small steps</div>


<!--
æ¬¡ã¯ã€TinyRuby ã®ä½œæˆã‚’é€šã—ã¦å­¦ã‚“ã ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä½œæˆæ™‚ã«ä½¿ãˆã‚‹ä¾¿åˆ©æƒ…å ±ã€Tipsã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

1) Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã®æ´»ç”¨
2) ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ABIã‚’çŸ¥ã‚‹
3) å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹
-->

---

### :one: Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’æ´»ç”¨ / Utilize the assembly code output by the C compiler

ã‚¢ã‚»ãƒ³ãƒ–ãƒªã®æ›¸ãæ–¹ã«æ‚©ã‚“ã ã‚‰ã€Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ç¢ºèªã™ã‚‹
<div class="en">
If you're struggling with how to write assembly code, check the assembly output by the C compiler</div>

- 2ã¤ã®ç¢ºèªæ–¹æ³•
  - (1) Compiler Explorer
  - (2) GCCã®`-S` Option

<!--
ã§ã¯ã€1ã¤ç›®ã®Tipsã€ŒCã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’æ´»ç”¨ã™ã‚‹ã€ã«ã¤ã„ã¦ãŠè©±ã—ã—ã¾ã™ã€‚

ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’æ›¸ã„ã¦ã„ã‚‹ã¨ã€ã€ŒCè¨€èªã§ã¯ã©ã†æ›¸ãã‹ã¯ã‚ã‹ã‚‹ã‘ã©ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒªã§ã©ã†æ›¸ã‘ã°ã„ã„ã‹åˆ†ã‹ã‚‰ãªã„ï¼ã€ã¨ã„ã†ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚

ãã‚“ãªæ™‚ã¯ã€å¸Œæœ›ã™ã‚‹å‡¦ç†ã‚’è¡Œã†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’Cã§æ›¸ãã€Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã•ã›ã‚‹ã“ã¨ã§ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã§ãã¾ã™ã€‚

Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã•ã›ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ã€ŒCompiler Explorerã‚’ä½¿ã†æ–¹æ³•ã€ã¨ã€ŒGCCã® `-S` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†æ–¹æ³•ã€ã®2ã¤ãŒãŠæ‰‹è»½ã§ä¾¿åˆ©ã§ã™ã€‚
-->

---

<style scoped> section { font-size: 2.0em; } </style>

## ã€€âš¡ï¸ Compiler Explorer ( https://godbolt.org/ )

æ§˜ã€…ãªè¨€èªãƒ»æ§˜ã€…ãªCPUã®ã‚¢ã‚»ãƒ³ãƒ–ãƒªå‡ºåŠ›ã‚’ç¢ºèªã§ãã‚‹ç¥ã‚µã‚¤ãƒˆ
<video src="godbolt.mov"   width="800" controls></video>

<!--
https://godbolt.org/

ã¾ãšã¯ Compiler Explorer ã‚’ä½¿ã†æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

Compiler Explorer ã¯ã€æ§˜ã€…ãªè¨€èªã€æ§˜ã€…ãªCPUãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ç¢ºèªã§ãã‚‹ã‚«ãƒƒã‚³ã„ã„ã‚µã‚¤ãƒˆã§ã™ã€‚

ï¼ˆå‹•ç”»ã‚’å†ç”Ÿï¼‰

ãƒ»Compiler Explorer ã®ç”»é¢ã¯2ã¤ã®é ˜åŸŸã«åˆ†ã‹ã‚Œã¦ã„ã¦ã€å·¦å´ã«ã¯ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã¨ã€å³å´ã«ãã®ã‚½ãƒ¼ã‚¹ã®ã‚¢ã‚»ãƒ³ãƒ–ãƒªãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

ãƒ»Cã®ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã©ã®éƒ¨åˆ†ãŒã€ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã®ã©ã®éƒ¨åˆ†ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ãŒã€è‰²ã«ã‚ˆã£ã¦ã‚ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒªã®ç†è§£ã«å½¹ç«‹ã¡ã¾ã™ã€‚
-->

---

## ğŸƒ GCCã® `-S` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

GCC ã® `-S` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€Cã‹ã‚‰ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’å‡ºåŠ›ã§ãã‚‹

```c
// test.c
int return_100() {
  return 100;
}
```

```sh
$ gcc -S -masm=intel test.c
```

<!--
æ¬¡ã«ã€GCCã®ã€Œ-Sã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

é€šå¸¸ã€GCCã«Cè¨€èªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ¸¡ã™ã¨ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

ã—ã‹ã—ã€gcc ã«ã€Œ-Sã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®ã¿ã‚’è¡Œã„ã€ãã®çµæœã‚’ã‚¢ã‚»ãƒ³ãƒ–ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªCè¨€èªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã€Œ-Sã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦å®Ÿè¡Œã™ã‚‹ã¨...ï¼ˆæ¬¡ã®ãƒšãƒ¼ã‚¸ï¼‰
-->

---

## ğŸƒğŸƒ GCCã® `-S` ã‚ªãƒ—ã‚·ãƒ§ãƒ³

å‡ºåŠ›ã•ã‚ŒãŸã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰

```sh
$ gcc -S -masm=intel test.c
$ cat test.s
	.intel_syntax noprefix
	.text
	.globl	return_100
	.type	return_100, @function
return_100:
	push	rbp
	mov	rbp, rsp
	mov	eax, 100
	pop	rbp
	ret
```

<!--
ã“ã®ã‚ˆã†ãªã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
-->

---

### âš¡ï¸ğŸƒ Compiler Explorer ã¨ GCC ã®ä½¿ã„åˆ†ã‘ / Differentiating the Use of Compiler Explorer and GCC

- When you need to compile the assembly as-is
  - â†’ GCC
  - Because Compiler Explorer cannot be built as it is when the directives are hidden
- Otherwise
  - â†’ Compiler Explorer

<!--
ã€ŒCompiler Explorerã€ã¨ã€ŒGCCã€ã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦ã§ã™ã€‚

åŸºæœ¬çš„ã«ã¯ã€ŒCompiler Explorerã€ã‚’ä½¿ã£ã¦ãŠã‘ã°OKã§ã™ãŒã€

Compiler Explorer ãŒå‡ºåŠ›ã—ãŸã‚¢ã‚»ãƒ³ãƒ–ãƒªã¯ã€å‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¨­å®šã«ã‚ˆã£ã¦ã¯ã€ãã®ã¾ã¾ãƒ“ãƒ«ãƒ‰ã§ããªã„ã“ã¨ãŒã¾ã¾ã‚ã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€å‡ºåŠ›ã—ãŸã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ãã®ã¾ã¾ãƒ“ãƒ«ãƒ‰ã«ã‹ã‘ãŸã„å ´åˆãªã©ã¯ã€ŒGCCã€ã§ã€‚

ãã†ã§ãªã„å ´åˆã¯ã€ŒCompiler Explorerã€ã‚’ä½¿ã†ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚
-->

---

# :two: ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ABIã‚’çŸ¥ã‚‹ / Understand registers and the ABI

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã¯ã€å¯¾è±¡ã¨ãªã‚‹CPUã®ã€Œãƒ¬ã‚¸ã‚¹ã‚¿æ§‹æˆã€ã¨ã€ŒABIã€ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹

To understand the assembly output by the compiler, you need to know the "registers" and "ABI" of the target CPU.

<!--
äºŒã¤ã‚ã®Tipsã¯ã€Œãƒ¬ã‚¸ã‚¹ã‚¿ã¨ABIã‚’çŸ¥ã‚‹ã€ã§ã™ã€‚

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‡ºåŠ›ã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã¯ã€å¯¾è±¡ã¨ãªã‚‹CPUã®ã€Œãƒ¬ã‚¸ã‚¹ã‚¿æ§‹æˆã€ã¨ã€ŒABIã€ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
-->

---

<style scoped> section { font-size: 1.5em; }</style>

### ğŸ“ æ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿ä¸€è¦§ / General-purpose registers

x86-64 ã® 16 æœ¬ã® 64 ãƒ“ãƒƒãƒˆæ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿

<table>
  <thead><th>ãƒ¬ã‚¸ã‚¹ã‚¿å</th><th>ç”¨é€”</th><th>ãƒ¬ã‚¸ã‚¹ã‚¿å</th><th>ç”¨é€”</th></thead>
  <tbody>
    <tr><td>RAX</td><td>é–¢æ•°ã®æˆ»ã‚Šå€¤ãªã©</td><td>R8</td><td>é–¢æ•°ã®ç¬¬äº”å¼•æ•°ãªã©</td></tr>
    <tr><td>RBX</td><td></td><td>R9</td><td>é–¢æ•°ã®ç¬¬å…­å¼•æ•°ãªã©</td></tr>
    <tr><td>RCX</td><td>é–¢æ•°ã®ç¬¬å››å¼•æ•°ãªã©</td><td>R10</td><td>ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ç½®ãå ´</td></tr>
    <tr><td>RDX</td><td>é–¢æ•°ã®ç¬¬ä¸‰å¼•æ•°ãªã©</td><td>R11</td><td>ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ç½®ãå ´</td></tr>
    <tr><td>RSI</td><td>é–¢æ•°ã®ç¬¬äºŒå¼•æ•°ãªã©</td><td>R12</td><td></td></tr>
    <tr><td>RDI</td><td>é–¢æ•°ã®ç¬¬ä¸€å¼•æ•°ãªã©</td><td>R13</td><td></td></tr>
    <tr><td>RBP</td><td>ãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ã‚¿</td><td>R14</td><td></td></tr>
    <tr><td>RSP</td><td>ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿</td><td>R15</td><td></td></tr>
  </tbody>
</table>

<!--
ã¾ãšãƒ¬ã‚¸ã‚¹ã‚¿ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

CPUã«ã¯ã€Œãƒ¬ã‚¸ã‚¹ã‚¿ã€ã¨å‘¼ã°ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®è¨˜æ†¶é ˜åŸŸãŒã‚ã‚Šã€CPUãŒæ¼”ç®—ã‚’è¡Œã†éš›ã«åˆ©ç”¨ã—ãŸã‚Šã€ä¸€æ™‚çš„ãªãƒ‡ãƒ¼ã‚¿ã®ç½®ãå ´ã¨ã—ã¦åˆ©ç”¨ã—ãŸã‚Šã—ã¾ã™ã€‚

x86-64 ã¯ã€ã“ã“ã«ç¤ºã™ 16 æœ¬ã® 64 ãƒ“ãƒƒãƒˆæ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€ã“ã‚Œä»¥å¤–ã«ã‚‚æµ®å‹•å°æ•°ç‚¹æ•°ç”¨ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã‚„ã€ãƒ•ãƒ©ã‚°ãƒ¬ã‚¸ã‚¹ã‚¿ãªã‚‹ã‚‚ã®ãŒã‚ã£ãŸã‚Šã—ã¾ã™ãŒã€ã“ã“ã§ã¯çœç•¥ã—ã¾ã™ã€‚
-->

---

# ğŸ¦ x86-64 ã®ABI (Application Binary Interface)

ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªãƒ¬ãƒ™ãƒ«ã§ã®é–¢æ•°ã®å‘¼ã³å‡ºã—è¦ç´„ãªã©ã®ã“ã¨

ABI (Application Binary Interface) is a set of conventions for functions at the assembly language level.

<!--
æ¬¡ã«ã€ABI ã«ã¤ã„ã¦ãŠè©±ã—ã—ã¾ã™ã€‚

ABI ã¨ã¯ã€Application Binary Interface ã®ç•¥ã§ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªãƒ¬ãƒ™ãƒ«ã§ã®é–¢æ•°ã®å‘¼ã³å‡ºã—ãªã©ã®è¦ç´„ã®ã“ã¨ã§ã™ã€‚
-->

---

### ğŸ¤§ é–¢æ•°ã®å¼•æ•°ã®æ¸¡ã—æ–¹ / Passing function arguments

- æœ€åˆã®6ã¤ã®å¼•æ•°ã¯ã€RDI, RSI, RDX, RCX, R8, R9 ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ¸¡ã™
- 7ã¤ç›®ä»¥é™ã®å¼•æ•°ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ã«ç©ã‚€

### ğŸ¸ é–¢æ•°ã®æˆ»ã‚Šå€¤ã®è¿”ã—æ–¹ / Returning function values

- æˆ»ã‚Šå€¤ã¯ã€RAX ãƒ¬ã‚¸ã‚¹ã‚¿ã«è¿”ã™

<!--
ä¾‹ãˆã°ã€x86-64 ã§é–¢æ•°ã‚’å‘¼ã³å‡ºã™éš›ã«ã¯ã€

ç¬¬ä¸€å¼•æ•°ã¯ RDI ãƒ¬ã‚¸ã‚¹ã‚¿ã€
ç¬¬äºŒå¼•æ•°ã¯ RSI ãƒ¬ã‚¸ã‚¹ã‚¿ã€
ã¨ã„ã£ãŸã‚ˆã†ã«ã€ã€Œç¬¬ä¸€å¼•æ•°ã€ã‹ã‚‰ã€Œç¬¬å…­å¼•æ•°ã€ã¾ã§ã®å€¤ã‚’ã€æ±ºã‚ã‚‰ã‚ŒãŸãƒ¬ã‚¸ã‚¹ã‚¿ã«ã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€ç¬¬ä¸ƒå¼•æ•°ä»¥é™ã¯ã‚¹ã‚¿ãƒƒã‚¯ã«å¼•æ•°ã®å€¤ã‚’ç©ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ãŒ ABI ã«ã‚ˆã£ã¦å®šã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

é–¢æ•°ã®æˆ»ã‚Šå€¤ã®è¿”ã—æ–¹ã‚‚ ABI ã§æ±ºã‚ã‚‰ã‚Œã¦ã„ã¦ã€æˆ»ã‚Šå€¤ã¯ RAX ãƒ¬ã‚¸ã‚¹ã‚¿ã«æ¸¡ã—ã¦è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ABI ã§ã“ã†ã—ãŸè¦ç´„ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€è¦ç´„ã«å¾“ã£ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã§ã®ç›¸äº’å‘¼ã³å‡ºã—ã‚„ã€ãƒ‡ãƒ¼ã‚¿ã®é€£æºãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
-->

---

## ğŸ¦€ ABI ã®è©³ç´°è³‡æ–™ / Detailed ABI documentation

x86-64 ã® ABI ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãªã©ã‚’å‚ç…§

- System V Application Binary Interface AMD64 Supplement
  - https://refspecs.linuxbase.org/elf/x86-64-abi-0.99.pdf

<!--
x86-64 ã® ABI ã®ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã«ã¤ã„ã¦ã¯ã€ã“ã¡ã‚‰ã®è³‡æ–™ãªã©ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã¾ãŸã€ã“ã‚Œã¯ x86-64 ä¸Šã§å‹•ä½œã™ã‚‹ Linux ã® ABI ãªã®ã§ã€ä»–ã® OSã€ä»–ã® CPU ã®å ´åˆã¯ã€å¯¾è±¡ã¨ãªã‚‹ç’°å¢ƒã® ABI ã‚’èª¿ã¹ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
-->

---

<style scoped> section { font-size: 1.9em; } </style>

## :three: å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹ / Progress in small steps

å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ã

- æ•´æ•°ãƒªãƒ†ãƒ©ãƒ« / Integer literals
- å››å‰‡æ¼”ç®— / Arithmetic operations
- ãƒ—ãƒªãƒ³ãƒˆé–¢æ•°å‘¼ã³å‡ºã— / Print function call
- è¤‡æ•°ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ / Multiple statements
- å¤‰æ•°ã®ä»£å…¥ã¨å‚ç…§ / Variable assignment and reference
- æ¯”è¼ƒæ¼”ç®— / Comparison operations
- æ¡ä»¶åˆ†å² / Conditional branching
- é–¢æ•°å‘¼ã³å‡ºã— / Function call
- é–¢æ•°å®šç¾© / Function definition

<!--
3ã¤ç›®ã®Tipsã¯ã€Œå°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹ã€ã§ã™ã€‚

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½œæˆã™ã‚‹éš›ã«ã€ä¸€åº¦ã«å…¨ã¦ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã®ã§ã¯ãªãã€å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’åˆ»ã¿ãªãŒã‚‰æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¨ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®å®Ÿè£…ãŒã—ã‚„ã™ãã€æŒ«æŠ˜ã‚‚ã—ã«ãããªã‚Šã¾ã™ã€‚

TinyRuby ã®é–‹ç™ºã§ã¯ã€
æ•´æ•°ãƒªãƒ†ãƒ©ãƒ«ã®è©•ä¾¡ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ã€
å››å‰‡æ¼”ç®—ã€ãƒ—ãƒªãƒ³ãƒˆé–¢æ•°å‘¼ã³å‡ºã—ã€è¤‡æ•°ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã€å¤‰æ•°ã®ä»£å…¥ã¨å‚ç…§ã€æ¯”è¼ƒæ¼”ç®—ã€æ¡ä»¶åˆ†å²ã€é–¢æ•°å‘¼ã³å‡ºã—ã€é–¢æ•°å®šç¾©ã€ã®é †ç•ªã§æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã—ãŸã€‚
-->

---

<style scoped> section { font-size: 1.9em; } </style>

## ğŸš¦ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º (TDD)

ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€1æ©Ÿèƒ½ãšã¤å®Ÿè£…ã—ã¦ã„ã

```test.sh
# æ•´æ•°ãƒªãƒ†ãƒ©ãƒ«
assert 4649 'p 4649'

# å››å‰‡æ¼”ç®—
assert 20 'p 10 + 20 - 30 * 4 / 12'
assert 60 'p 10 + 20 + 30'
assert 40 'p 30 + 20 - 10'
assert 200 'p 10 * 20'
assert 33 'p 99 / 3'

# è¤‡æ–‡
assert 4649 '1 + 1; p 4649'

# å¤‰æ•°
assert 10 'a = 10; p a'
assert 30 'a = 10; b = 20; p a + b'
```

<!--
ã¾ãŸã€æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹éš›ã«ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã‹ã‚‰æ©Ÿèƒ½ã‚’1ã¤ãšã¤å®Ÿè£…ã—ã¦ã„ãã€Œãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã€ã§é–‹ç™ºã‚’è¡Œã„ã¾ã—ãŸã€‚

ã¾ãšã¯æ•´æ•°ãƒªãƒ†ãƒ©ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’å®Ÿè£…ã€
æ¬¡ã«å››å‰‡æ¼”ç®—ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’å®Ÿè£…ã€
ãã®æ¬¡ã«è¤‡æ•°ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’å®Ÿè£…ã€

ã¨ã„ã†ã‚ˆã†ãªã‚µã‚¤ã‚¯ãƒ«ã‚’ã€ã™ã¹ã¦ã®æ©Ÿèƒ½ã®å®Ÿè£…ãŒçµ‚ã‚ã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚
-->

---

### ğŸ¾ å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹ã“ã¨ã®åˆ©ç‚¹ / Advantages of "Progress in small steps"

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«å¿…è¦ãªçŸ¥è­˜ã‚’æ®µéšçš„ã«ç¿’å¾—ã§ãã‚‹
  <div class="en">
  You can learn the essential knowledge for compilers gradually.</div>
- é©åº¦ãªç²’åº¦ã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚„ã™ã„ â†’ ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºãŒè¡Œã„ã‚„ã™ã„
  <div class="en">
  You can write tests at an appropriate granularity, making test-driven development easier.</div>

<!--
ã¾ãŸã€å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹ã“ã¨ã®ãƒ¡ãƒªãƒƒãƒˆã¯ã€

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«å¿…è¦ãªçŸ¥è­˜ã‚’æ®µéšçš„ã«ç¿’å¾—ã§ãã‚‹
- é©åº¦ãªç²’åº¦ã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚„ã™ã„ãŸã‚ã€ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºãŒè¡Œã„ã‚„ã™ã„

ã¨ã„ã†ã®ãŒãƒ¡ãƒªãƒƒãƒˆã«ãªã‚Šã¾ã™ã€‚
-->

---

### ğŸš— ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º(TDD)ã®åˆ©ç‚¹ / Advantages of "TDD"

- ç›®ã®å‰ã®å•é¡Œã«ã ã‘é›†ä¸­ã§ãã‚‹
  <div class="en">
  You can focus entirely on the issue at hand.</div>
- ãƒ†ã‚¹ãƒˆå®Ÿæ–½ãŒå®¹æ˜“
  <div class="en">
  Testing is easy.</div>
- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å³æ™‚ã«å¾—ã‚‰ã‚Œã‚‹
  <div class="en">
  You can get feedback immediately.</div>
- çŸ­ã„ã‚µã‚¤ã‚¯ãƒ«ã§é”æˆæ„Ÿã‚’å¾—ã‚‰ã‚Œã‚‹ãŸã‚ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿ã¡ã‚„ã™ã„
  <div class="en">
  Frequent accomplishments in short cycles help sustain motivation.</div>



<!--
ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§é€²ã‚ã‚‹ã“ã¨ã®ãƒ¡ãƒªãƒƒãƒˆã¯ã€

- ç›®ã®å‰ã®å•é¡Œã«ã ã‘é›†ä¸­ã§ãã‚‹
- ãƒ†ã‚¹ãƒˆå®Ÿæ–½ãŒå®¹æ˜“
- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å³æ™‚ã«å¾—ã‚‰ã‚Œã‚‹
- çŸ­ã„ã‚µã‚¤ã‚¯ãƒ«ã§é”æˆæ„Ÿã‚’å¾—ã‚‰ã‚Œã‚‹ãŸã‚ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã—ã‚„ã™ã„

ãªã©ãŒã‚ã‚Šã¾ã™ã€‚
-->

---

### ğŸ“– å‚è€ƒè³‡æ–™ / References

- ä½ãƒ¬ã‚¤ãƒ¤ã‚’çŸ¥ã‚ŠãŸã„äººã®ãŸã‚ã®Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä½œæˆå…¥é–€
  - https://www.sigbus.info/compilerbook
- An Incremental Approach to Compiler Construction
  - http://scheme2006.cs.uchicago.edu/11-ghuloum.pdf

<!--
ã€Œå°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©é–‹ç™ºã‚’é€²ã‚ã‚‹æ–¹æ³•ã€ã‚„ã€Œãƒ†ã‚¹ãƒˆé§†å‹•ã§ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«é–‹ç™ºã€ã«ã¤ã„ã¦ã¯ã€ã“ã®2ã¤ã®å‚è€ƒè³‡æ–™ãŒå…ƒã«ãªã£ã¦ã„ã¾ã™ã€‚ãœã²ã€ã“ã¡ã‚‰ã‚‚èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚
-->

---

<!-- _class: lead invert -->

# :rocket: First Steps in Building a Compiler

ã“ã‚Œã¾ã§ç´¹ä»‹ã—ãŸTipsã‚’ä½¿ã£ã¦ã€æ•´æ•°ã‚’è©•ä¾¡ã—ã¦ãƒªã‚¿ãƒ¼ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦è¿”ã™ã ã‘ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½œæˆã—ã¾ã™

<video src="TinyRubyDemo2.mov"   width="800" controls></video>

---

<!-- _class: lead invert -->

## ğŸ‰ Next Steps

https://scrapbox.io/htkymtks/TinyRubyã‚³ãƒ³ãƒ‘ã‚¤ãƒ©

![](qrcode.png)

<!--
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ä½œæˆæ‰‹é †ã«ã¤ã„ã¦ã®èª¬æ˜ã¯ä»Šæ—¥ã¯ã“ã“ã¾ã§ã§ã™ãŒã€

ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ãŒ Cosense ã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã®ã§ã€æ°—ã«ãªã‚‹æ–¹ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ã€‚
-->

---

### ğŸœ Summary

- Introduction to TinyRuby
- Tips for Building a Compiler
  - Utilize the assembly code output by the C compiler
  - Understand registers and the ABI
  - Progress in small steps
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä½œã£ã¦ã¿ãŸããªã£ãŸï¼Ÿ
  <div class="en">Feeling like trying to build a compiler?</div>
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’é€šã—ã¦ä½ãƒ¬ã‚¤ãƒ¤ã®ä¸–ç•Œã«ãµã‚Œã¦ã¿ã‚ˆã†ï¼
  <div class="en">Dive into the world of low-level programming through compilers!</div>


<!--
ã§ã¯ã€æœ¬æ—¥ã®ã¾ã¨ã‚ã§ã™ã€‚

TinyRubyã®ç´¹ä»‹ã¨ã€
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä½œæˆã®Tipsã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ä»Šå›ã®ç™ºè¡¨ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä½œã£ã¦ã¿ãŸã„ï¼ã¨æ€ã£ã¦ã„ãŸã ã‘ãŸã‚‰å¬‰ã—ã„ã§ã™ã€‚
ãœã²ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’é€šã—ã¦ä½ãƒ¬ã‚¤ãƒ¤ã®ä¸–ç•Œã«è§¦ã‚Œã¦ã¿ã¦ãã ã•ã„ã€‚
-->

---

<!-- _class: lead invert -->

# ğŸ’ çµ‚
